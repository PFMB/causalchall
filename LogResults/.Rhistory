w <- as.numeric(gal > c1)*1 +  as.numeric(gal <= c1)*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
#
res2[i,4] <- weighted.mean(gdat$Y_0,w=w)
res2[i,5] <- round(mean(w),digits=4)
res2[i,6] <- round(mean(gal),digits=4)
}
res2
gal
res2 <- data.frame(matrix(NA,ncol=6,nrow=n.int))
res2[,1] <- a.int; res2[,2] <- psi_true$psi[psi_true$times==0]
res2[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res2) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal")
c1 <- 1
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1)*1 +  as.numeric(gal <= c1)*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
#
res2[i,4] <- weighted.mean(gdat$Y_0,w=w)
res2[i,5] <- round(mean(w),digits=4)
res2[i,6] <- round(mean(gal),digits=4)
}
res2
w
weighted.mean(gdat$Y_0,w=w)
t(gdat$Y_0)%*%w
t(w)%*%gdat$Y_0
sum(w)
1523.124/524.7111
(t(w)%*%gdat$Y_0/sum(w))
res2
head(gdat)
weighted.quantile
res3 <- data.frame(matrix(NA,ncol=6,nrow=n.int))
res3[,1] <- a.int; res3[,2] <- psi_true$psi[psi_true$times==0]
res3[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res3) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal")
c1 <- 1
res3
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1)*1 +  as.numeric(gal <= c1)*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
#
if(i==1){gdatstack <- gdat}else{gdatstack <- rbind(gdatstack,gdat)}
}
View(gdatstack)
head(gdatstack))
head(gdatstack)
m.stack <- lm(Y_0~A_0,data=gdatstack)
summary(m.stack)
m.stack <- gam(Y_0~s(A_0),data=gdatstack)
library(mgcv)
m.stack <- gam(Y_0~s(A_0),data=gdatstack)
summary(m.stack)
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1)*1 +  as.numeric(gal <= c1)*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
gdat$w <- w
#
if(i==1){gdatstack <- gdat}else{gdatstack <- rbind(gdatstack,gdat)}
}
m.stack <- lm(Y_0~A_0,data=gdatstack,weight=w)
summary(m.stack)
head(gdatstack)
summary(gdatstack$w)
a.int
n.int
pdata <- data.frame(matrix(NA,ncol=5,nrow=n.int,dimnames = list(NA,colnames(gdatstack))
))
pdata <- data.frame(matrix(NA,ncol=5,nrow=n.int,dimnames = list(NULL,colnames(gdatstack))))
pdata
pdata$A_0 <- a.int
predict(m.stack,newdata = pdata$A_0)
predict(m.stack,newdata = pdata)
res3 <- data.frame(matrix(NA,ncol=6,nrow=n.int))
res3[,1] <- a.int; res3[,2] <- psi_true$psi[psi_true$times==0]
res3[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res3) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal")
c1 <- 1
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1)*1 +  as.numeric(gal <= c1)*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
gdat$w <- w
#
if(i==1){gdatstack <- gdat}else{gdatstack <- rbind(gdatstack,gdat)}
#
res3[i,5] <- round(mean(w),digits=4)
res3[i,6] <- round(mean(gal),digits=4)
}
m.stack <- lm(Y_0~A_0,data=gdatstack,weight=w)
pdata <- data.frame(matrix(NA,ncol=5,nrow=n.int,dimnames = list(NULL,colnames(gdatstack))))
pdata$A_0 <- a.int
res3[,4] <- predict(m.stack,newdata = pdata)
res3
res2
c1 <- c(0.001,0.01,0.1,0.25,0.5,1)
res4 <- data.frame(matrix(NA,ncol=7,nrow=n.int*length(c1)))
res4[,1] <- a.int; res4[,2] <- psi_true$psi[psi_true$times==0]
res4[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res4) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal","c1")
res4
c1 <- c(0.001,0.01,0.1,0.25,0.5,1)
res4 <- data.frame(matrix(NA,ncol=7,nrow=n.int*length(c1)))
res4[,1] <- a.int; res4[,2] <- psi_true$psi[psi_true$times==0]
res4[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res4) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal","c1")
for(j in 1:length(c1)){
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1[j])*1 +  as.numeric(gal <= c1[j])*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
#
res4[i+(n.int*(j-1)),4] <- weighted.mean(gdat$Y_0,w=w) #(t(w)%*%gdat$Y_0/sum(w))
res4[i+(n.int*(j-1)),5] <- round(mean(w),digits=4)
res4[i+(n.int*(j-1)),6] <- round(mean(gal),digits=4)
res4[i+(n.int*(j-1)),7] <- c1[j]
}}
res4
plot(Int, psi_true, type="l")
plot(Int, psi_true, type="l",data=res4)
?plot
res2
plot(res2$Int, res$psi_true, type="l")
plot(res2$Int, res2$psi_true, type="l")
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) / E(Y|a)",cex.axis=1.75,lwd=3,cex.lab=1.75,cex.main=1.75)
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) / E(Y|a)",cex.axis=1.75,lwd=3,cex.lab=1.75,cex.main=1.75)
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",cex.axis=1.75,lwd=3,cex.lab=1.75,cex.main=1.75)
plot(res2$Int, res2$psi_true_preint, type="l", col="red")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
plot(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
rainbow
rainbow(length(c1))
res4
cols <- rainbow(length(c1))
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res2$psi_est[res4$c1==c1[1]], type="l", col=rainbow[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[1]], res2$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
c1
cols <- rainbow(length(c1))
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res2$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res2$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res2$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res2$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res2$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res2$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
cols <- rainbow(length(c1))
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
res4
summary(res4$psi_est)
cols <- rainbow(length(c1))
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
c1 <- c(0,0.0001,0.001,0.01,0.1,0.25,1)
res4 <- data.frame(matrix(NA,ncol=7,nrow=n.int*length(c1)))
res4[,1] <- a.int; res4[,2] <- psi_true$psi[psi_true$times==0]
res4[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res4) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal","c1")
for(j in 1:length(c1)){
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1[j])*1 +  as.numeric(gal <= c1[j])*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
#
res4[i+(n.int*(j-1)),4] <- weighted.mean(gdat$Y_0,w=w) #(t(w)%*%gdat$Y_0/sum(w))
res4[i+(n.int*(j-1)),5] <- round(mean(w),digits=4)
res4[i+(n.int*(j-1)),6] <- round(mean(gal),digits=4)
res4[i+(n.int*(j-1)),7] <- c1[j]
}}
res4
cols <- rainbow(length(c1))
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75)
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
install.packages("RColorBrewer")
library(RColorBrewer)
brewer.pal(n = length(c1), name = "RdYlBu")
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="blue")
lines(res2$Int, res2$psi_true_preint, type="l", col="red", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
#########
c1 <- c(0,0.00001,0.0001,0.001,0.01,0.1,0.25,1)
res4 <- data.frame(matrix(NA,ncol=7,nrow=n.int*length(c1)))
res4[,1] <- a.int; res4[,2] <- psi_true$psi[psi_true$times==0]
res4[,3] <- psi_true_preint$psi[psi_true_preint$times==0]
colnames(res4) <- c("Int","psi_true","psi_true_preint","psi_est","w","gal","c1")
for(j in 1:length(c1)){
for(i in 1:n.int){
# weights
m.A1 <- lm(A_0~L1_0+L2_0,data=dat)
m.A2 <- lm(A_0~1,data=dat)
gal <- dnorm(a.int[i],mean=predict(m.A1),sd=summary(m.A1)$sigma)
ga <-  dnorm(a.int[i],mean=predict(m.A2),sd=summary(m.A2)$sigma)
w <- as.numeric(gal > c1[j])*1 +  as.numeric(gal <= c1[j])*(gal/ga)
#
gdat <- dat; gdat$A_0 <- a.int[i]; gdat$Y_0 <- NA
m.Y <- lm(Y_0 ~ ., data=dat)
gdat$Y_0 <- predict(m.Y,newdata=gdat)
#
res4[i+(n.int*(j-1)),4] <- weighted.mean(gdat$Y_0,w=w) #(t(w)%*%gdat$Y_0/sum(w))
res4[i+(n.int*(j-1)),5] <- round(mean(w),digits=4)
res4[i+(n.int*(j-1)),6] <- round(mean(gal),digits=4)
res4[i+(n.int*(j-1)),7] <- c1[j]
}}
res4
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),xlim=c(0,10),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red",sub="Note: E(Y|A=a) may not be defined everywhere")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),xlim=c(0,10),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red",sub="\n Note: E(Y|A=a) may not be defined everywhere")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
?legend
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),xlim=c(0,10),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red",sub="\n Note: E(Y|A=a) may not be defined everywhere")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
legend("bottomright", legend = letters[1:10], cols=c("red","blue",cols), lty=c(rep(1,2),rep(3,length(c1))))
?legend
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),xlim=c(0,10),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red",sub="\n Note: E(Y|A=a) may not be defined everywhere")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
legend("bottomright", legend = letters[1:10], col=c("red","blue",cols), lty=c(rep(1,2),rep(3,length(c1))))
?legend
library(RColorBrewer)
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),xlim=c(0,10),cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red",sub="\n Note: E(Y|A=a) may not be defined everywhere")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
legend("bottomright", legend = letters[1:10], col=c("red","blue",cols), lty=c(rep(1,2),rep(3,length(c1))),lwd=3,ncol=2)
c1[1]
cols <- brewer.pal(n = length(c1), name = "RdYlBu")
par(mar= c(5, 5, 2, 2))
plot(res2$Int, res2$psi_true, type="l", xlab="Intervention (A)", ylab="E(Y^a) or E(Y|a)",ylim=c(-5,3),xlim=c(0,10),
cex.axis=1.75,lwd=2,cex.lab=1.75,cex.main=1.75,col="red",sub="\n Note: E(Y|A=a) may not be defined everywhere",
main="Estimated psi based on varying c1")
lines(res2$Int, res2$psi_true_preint, type="l", col="blue", lwd=2)
lines(res4$Int[res4$c1==c1[1]], res4$psi_est[res4$c1==c1[1]], type="l", col=cols[1], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[2]], res4$psi_est[res4$c1==c1[2]], type="l", col=cols[2], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[3]], res4$psi_est[res4$c1==c1[3]], type="l", col=cols[3], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[4]], res4$psi_est[res4$c1==c1[4]], type="l", col=cols[4], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[5]], res4$psi_est[res4$c1==c1[5]], type="l", col=cols[5], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[6]], res4$psi_est[res4$c1==c1[6]], type="l", col=cols[6], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[7]], res4$psi_est[res4$c1==c1[7]], type="l", col=cols[7], lwd=2, lty=3)
lines(res4$Int[res4$c1==c1[8]], res4$psi_est[res4$c1==c1[8]], type="l", col=cols[8], lwd=2, lty=3)
legend("bottomright", legend = c("True E(Y^a)","True E(Y|A=a)","c1=0","","","","","","",""),
col=c("red","blue",cols), lty=c(rep(1,2),rep(3,length(c1))),lwd=3,ncol=2)
install.packages("mlt")
library(mlt)
?mlt
dist <- numeric_var("dist", support = c(2.0, 100), bounds = c(0, Inf))
speed <- numeric_var("speed", support = c(5.0, 23), bounds = c(0, Inf))
ctmm <- ctm(response = Bernstein_basis(dist, order = 4, ui = "increasing"),
interacting = Bernstein_basis(speed, order = 3))
mltm <- mlt(ctmm, data = cars)
mltm <- mlt(ctmm, data = cars)
mltm
cars
### plot data
plot(cars)
### predict quantiles and overlay data with model via a "quantile sheet"
q <- predict(mltm, newdata = data.frame(speed = 0:24), type = "quantile",
p = 2:8 / 10, K = 500)
tmp <- apply(q, 1, function(x) lines(0:24, x, type = "l"))
library(simcausal)
M <- DAG.empty()
M <- M +
node("w1", #age (0/1); 1 -> high age
distr = "rbern",
prob = .6) +
node("w2", #ses (1/2/3/4/5); higher age, higher probability of belonging to upper class
distr = "rcat.b1",
probs = {
plogis(-3.1 - 0.05*w1);     # 1 = upper middle class, 4%
plogis(-1.25 - 0.04*w1);    # 2 = middle class, 22%
plogis(-0.05 - 0.03*w1);    # 3 = lower middle  49%
plogis(-1.65 - 0.02*w1)}) + # 4 = working class  16%
# 5= last class comes from "normalizing", about 9%
node("w3", #comorbidities (1/2/3/4/5);
distr = "rcat.b1",
probs = {
plogis(-0.5   + 0.010*w1 + 0.15*w2)      # 1= none
plogis(-1.8 + 0.005*w1 + 0.1*w2);        # 2=  Hypertension
plogis(-1.6  + 0.010*w1 + 0.12*w2);      # 3=  Diabetes II
plogis(-1.5   + 0.010*w1 + 0.15*w2);       # 4 = other
plogis(-2.5   + 0.020*w1 + 0.20*w2);     # 5 = alzheimer
plogis(-2.3 + 0.015*w1 + 0.15*w2)}) +  # 6=  previous heart attack
node("w4", # stage (1/2/3/4);
distr = "rcat.b1",
probs = {
plogis(-0.4 + 0.02*w1 - 0.05*w2);
plogis(-1 + 0.03*w1 - 0.055*w2);
plogis(-1.2 + 0.01*w1 - 0.04*w2)}) +
node("a",    #a = 1 -> chemotherapy + radiotherapy; a=0 chemo
distr = "rbern",
prob = plogis(-1.4 + 0.05*w2 + 0.25*w3 + 0.1*exp(w4))) +
node("y", #y = 0 -> alive;  y=1 -> death
distr = "rbern",
prob = 1-plogis(4.25 + 2.904*a - 0.65*w1 - 0.25*log(w2^2) - 0.2*w3 - 1.5*sqrt(w4) - 0.32*a*log(w2^2) - 0.32*a*w3))
Mset <- set.DAG(M)
# simulate observed data
Odat <- simcausal::sim(DAG = Mset, n = 5000, rndseed = 345)
# annotated data with factors (for regression)
Odat1 <- Odat
Odat1$w1 <- factor(Odat$w1,levels=c(0,1),labels=c("young","old"))
Odat1$w2 <- factor(Odat$w2,levels=c(1,2,3,4,5),labels=c("1_upper middle","2_middle","3_lower middle","4_working","5_non-working"))
Odat1$w3 <- factor(Odat$w3, levels=c(1:6),labels=c("none","hypertension","diabetes","other","alzheimer","heart attack"))
Odat1$w4 <- factor(Odat$w4, levels=c(1:4),labels=c("stage 1","stage 2","stage 3","stage 4"))
#Odat$a <- factor(Odat$a, levels=c(0,1),labels=c("chemo","chemo+radio"))
summary(Odat1)
write.csv(Odat1, "simulated_cancer_data.csv")
# specify the two interventions
a1 <- node("a", distr = "rbern", prob = 1)
Mset <- Mset + action("a1", nodes = a1)
a0 <- node("a", distr = "rbern", prob = 0)
Mset <- Mset + action("a0", nodes = a0)
#k counterfactual data to estimate true ATE -> n = 10.000.000 !!
dat <- simcausal::sim(DAG = Mset, actions = c("a1", "a0"), n = 10000, rndseed = 345)
str(dat)
head(dat[["a1"]])
head(dat[["a0"]])
head(Odat)
.libPaths()
setwd("C:/Users/ua341au/Dropbox/Documents/Projects_Other/ACIC_2022_data_challenge")
#setwd("C:/Users/01465840.F875A4D1C344/Dropbox/Documents/Projects_Other/ACIC_2022_data_challenge")
results <- read.csv("ACIC_results.csv")
results[results$Submission=="MSM+",]
results$year[is.na(results$year)] <- 0
lapply(split(results[results$Submission=="MSM+",c("bias","abs_bias","rmse","cover","width")],
results$year[results$Submission=="MSM+"]),colMeans)
results2 <- read.csv("ACIC_estimand_truths.csv")
head(results2)
summary(results2$SATT)
summary(results2$SATT[results2$year==3])
summary(results2$SATT[results2$year==4])
summary(results2$SATT[results2$year==3])
summary(results2$SATT[results2$year==4]-results2$SATT[results2$year==3])
setwd("C:/Users/ua341au/Dropbox/Documents/GitHub/causalchall/LogResults")
#setwd("C:/Users/01465840.F875A4D1C344/Dropbox/Documents/GitHub/causalchall/LogResults")
results3 <- read.csv("results_1.csv")
results4 <- read.csv("results_1.csv")
results5 <- rbind(results3,results4)
summary(results5)
# summary
# estimated bias
lapply(split(results[results$Submission=="MSM+",c("bias","abs_bias","rmse","cover","width")],
results$year[results$Submission=="MSM+"]),colMeans)
summary(results2$SATT[results2$year==3])
summary(results2$SATT[results2$year==4])
head(results)
lapply(split(results[results$Submission=="MSM+",c("bias","abs_bias","rmse","cover","width")],
results$variable[results$Submission=="MSM+"]),colMeans)
library(MSM)
library(ltmle)
?ltmleMSM
lapply(split(results[results$Submission=="MSM+",c("bias","abs_bias","rmse","cover","width")],
results$year[results$Submission=="MSM+"]),colMeans)
